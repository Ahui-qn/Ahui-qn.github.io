<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./paintboard-font/iconfont.css">
    <style>   
   
/* ------------------------------上面是字体图标--------------------------------- */
    
        body , html{
            width: 100%;
            height: 100%;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            list-style: none;

            moz-user-select: -moz-none;
            -moz-user-select: none;
            -o-user-select:none;
            -khtml-user-select:none;
            -webkit-user-select:none;
            -ms-user-select:none;
            user-select:none;

        }
        .svgContainer{
            width: 100%;
            height: 100%;
            background-color: rgb(255, 255, 255);
            position: relative;
        }
        .svg {
            border: 5px solid rgb(154, 241, 168);
        }
        .toolContainer{
            position: absolute;
            display: flex;
            justify-content: space-between;
            height: 450px;
            width: 100%;
            top: 50%;
            transform: translateY(-50%);
        }
        .tool-rangeBox {
            position: relative;
            width: 140px;
        }
        .toolbar {
            border-radius: 0px 40px 40px 0;
            width: 70px;
            height: 450px;
            border: 2px solid rgb(255, 255, 255);
            box-shadow:  0px 1px 9px 0px rgba(90, 90, 90, 0.308);
            background-color: rgb(227, 240, 255);
            display: flex;
            flex-direction: column;
            justify-content: space-evenly;
            align-items: center;
        }
        .toolbar > label {      /*字体图标*/
            text-align: center;
            line-height: 45px;
            width: 60px;
            height: 50px;
            border: solid 2px rgb(227, 240, 255);
            border-radius: 10px;
            font-size: 25px;
            color: rgb(15, 95, 223);
            background-color: rgb(227, 240, 255);
            transition: 0.4s ease;
        }
        .toolbar > label:hover {
            transition: 0.4s ease;
            border: solid 2px rgb(125, 166, 255);
        }

        .tool-rangeBox  input[id="icon-bi"]:checked ~ .toolbar label.icon-bi {
            transition: 0.4s ease;
            background-color: rgb(255, 161, 213);
        }
        .tool-rangeBox  input[id="icon-zhixian"]:checked ~ .toolbar label.icon-zhixian {
            transition: 0.4s ease;
            background-color: rgb(255, 161, 213);
        }
        .tool-rangeBox  input[id="icon-wubianxing"]:checked ~ .toolbar label.icon-wubianxing {
            transition: 0.4s ease;
            background-color: rgb(255, 161, 213);
        }
        .tool-rangeBox  input[id="icon-yuanxing"]:checked ~ .toolbar label.icon-yuanxing {
            transition: 0.4s ease;
            background-color: rgb(255, 161, 213);
        }
        .tool-rangeBox  input[id="icon-juxing"]:checked ~ .toolbar label.icon-juxing {
            transition: 0.4s ease;
            background-color: rgb(255, 161, 213);
        }
        .tool-rangeBox  input[name="toolselect"] {
            visibility: hidden;
        }











        /*  背景色和FIll*/
        label.back-bgc, label.forth-bgc {
            position: absolute;
            display: inline-block;
            width: 35px;
            height:35px;
            border-radius: 10px;
            box-shadow:2px 3px 3px 0px rgb(0 0 0 / 12%) ;
        }
        label.back-bgc {
            top: 385px;
            left: 88px;
            background-color: rgb(97, 100, 250);
        }
        label.forth-bgc {
            top: 402px;
            left: 102px;
            background-color: rgb(255, 156, 206);
        }
        label.fill {
            width: 33px;
            height: 33px;
            position: absolute;
            top: 302px;
            left:96px;
            background-color: rgb(70, 70, 70);
            border-radius: 12px;
            box-shadow: 0 0 0 0 rgba(17, 4, 4, 0);
            border:solid 1px rgb(93, 93, 93);
            transform: translateY(0px);
            transition: 0.3s ease;
        }
        .tool-rangeBox p {
            position: absolute;
            text-align: center;
            line-height: 20px;
            border-radius: 6px;
            width: 30px;
            height: 20px;
            background-color: rgb(218, 218, 218);
            color: #333;
            top: 342px;
            left: 97px;
            font-size: 12px;
            transition: 0.4s ease;
        }
        .tool-rangeBox #fill {
            visibility: hidden;
        }
        .tool-rangeBox #fill:checked + label.fill{
            transition: 0.3s ease;
            transform: translateY(-4px);
            background-color: rgb(94, 255, 135);
            border:solid 1px rgb(255, 255, 255);
            box-shadow: 0px 5px 5px 0 #00440933;
        }
        .tool-rangeBox #fill:checked + label.fill + p {
            background-color: rgb(94, 255, 135);
        }
        
        .tool-rangeBox > label  input[type="color"] {
            visibility: hidden;
        }

        /* 笔画大小 滑条*/
        em {
            position: absolute;
            top: 28px;
            left: 97px;
            width:30px;
            height: 30px;
            color: rgb(130, 121, 253);
            font-weight: bolder;
            border-radius: 999px;
            font-style:normal;
            font-size: 18px;
            text-align: center;
            line-height: 30px;
            background-color:rgb(213, 228, 255);
            opacity: 0;
            transition: 2s ease;
        }
        .range:hover + em{
            transition: 0.3s ease;
            opacity: 1;
        }
        .range{
            display: inline-block;
            transform: rotate(-90deg) translate(321px, 8px);
        }
        .range > input[type="range"] {
            -webkit-appearance: none; /*去除默认样式*/
            background-color: rgb(193, 222, 255);
            width: 200px ;
            height:4px;
            padding: 0;
            border: none;    
            box-shadow: -8px 3px 7px 0px rgb(0 0 0 / 12%);
        }
        .range > input[type=range]::-webkit-slider-thumb  {
            -webkit-appearance: none;/*去除默认样式*/
              cursor: default;
              top: 0;
              height: 20px;
              width: 20px;
              transform: translateY(0px);
              /*background: none repeat scroll 0 0 #5891f5;*/
              background: #fff;
              border-radius: 15px;
              border: 5px solid #006eb3;
              /*-webkit-box-shadow: 0 -1px 1px #fc7701 inset;*/
        }
       




        /* ------------------------右边的颜色选择------------------------ */
        .colorContainer{
            margin-right: 40px;
            width: 40px;
            height: 100%;
        }
        .colors {
            display: block;
            width: 45px;
            height: 45px;
            border-radius: 999px;
            border: 1px solid rgb(216, 216, 216);
        }
        #color{
            opacity: 0;
        }
        .colorSelect {
            margin-top: 15px;
            width: 45px;
            height:85%;
            background-color: rgb(166, 159, 255);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-evenly;
            overflow: hidden;
            box-shadow: 0px 1px 9px 0px rgba(99, 133, 95, 0.26);
            cursor: pointer;
        }
        .colorSelect > li {
            flex:auto;
            background-color: rgb(125, 213, 248);
        }
        .colorSelect > li:not(li:nth-of-type(1)) {
            border-top: 2px rgb(255, 255, 255) solid;
        }

        /*保存和打开*/
        div.save-open {
            position: absolute;
            display: flex;
            justify-content: space-between;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
        }
        div.save-open .save, div.save-open .open {
            width: 80px;
            height: 40px;
            border-width: 0px;
            border-radius: 999px; /* 边框半径 */
            box-shadow: 0px 0px 0px 0px #0000;
            background: #3496f8; /* 背景颜色 */
            cursor: pointer; /* 鼠标移入按钮范围时出现手势 */
            outline: none;
            color: white; /* 字体颜色 */
            font-size: 16px; /* 字体大小 */
            transition: 0.4s ease;
        }
        div.save-open .save:hover, div.save-open .open:hover {
            transition: 0.4s ease;
            transform:translateY(4px);
            box-shadow: 0px 2px 6px 0px rgba(20, 50, 116, 0.397);

        }
    </style>
</head>
<body>
    <div class="svgContainer">
        <!-- 中间工具 -->
        <section class="toolContainer">
            <div class="tool-rangeBox">
                    <input type="radio" name="toolselect" id="icon-bi" checked>
                    <input type="radio" name="toolselect" id="icon-zhixian">
                    <input type="radio" name="toolselect" id="icon-wubianxing">
                    <input type="radio" name="toolselect" id="icon-yuanxing">
                    <input type="radio" name="toolselect" id="icon-juxing">
                <div class="toolbar">
                    <label for="icon-bi" class="iconfont icon-bi"></label>
                    <label for="icon-zhixian" class="iconfont icon-zhixian"></label>
                    <label for="icon-wubianxing" class="iconfont icon-wubianxing"></label>
                    <label for="icon-yuanxing" class="iconfont icon-yuanxing"></label>
                    <label for="icon-juxing" class="iconfont icon-juxing"></label>
                </div>
                
                <span class="range">
                    <input type="range" max="10" min="1" id="widthInput" value="2" >
                </span>
                <em>2</em>
                <label class="back-bgc" for="back-bgc"><input type="color" id="back-bgc"></label>
                <label class="forth-bgc" for="forth-bgc"><input type="color" id="forth-bgc"></label>
                <input type="checkbox" id="fill">
                <label class="fill" for="fill"></label>
                <p>FILL</p>
            </div>

            <div class="colorContainer">
                <label class="colors" for="color" style="background-color: rgb(0, 47, 93);">
                        <input type="color" id="color">  <!--当input-color 改变时，对应的背景颜色改变-->  
                </label>
                <ul class="colorSelect">
                    <li style="background-color: rgb(241, 167, 154);"></li>
                    <li style="background-color: rgb(255, 217, 128);"></li>
                    <li style="background-color: rgb(172, 238, 163);"></li>
                    <li style="background-color: rgb(49, 245, 131);"></li>
                    <li style="background-color: rgb(77, 250, 198);"></li>
                    <li style="background-color: rgb(154, 182, 241);"></li>
                    <li style="background-color: rgb(228, 137, 255);"></li>
                    <li style="background-color: rgb(253, 136, 191);"></li>
                </ul>
            </div>
        </section>
        <div class="save-open">
            <button class="save">save</button>
            <button class="open">open</button>
        </div>
        
        <svg
        class="svg"
        width="100%"
        height="100%"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
    ></svg>
    </div>
</body>
</html>
<script>
    
    let svgContainer = document.querySelector('div.svgContainer')
    let svg = document.querySelector('.svg')
    //  下面这块是左边工具的变量名
    let toolContainer = document.querySelector('.toolContainer')   // 中间工具栏那块，把svgContainer挡住了，所以事件监听再判断一个
    let colorContainer = document.querySelector('.colorContainer')  // 屏幕右边颜色调和colorinput的容器
    let toolRangeBox = document.querySelector('.tool-rangeBox')   // 左边所有工具的容器
    let range = document.querySelector('.range')   // 滑动条
    let rangeText = document.querySelector('em')  // 滑动条的数字显示
    // 下面这块是右边工具的变量名
    let colorSelectUl = document.querySelector('.colorSelect') // 右边那一条的颜色框
    let colorSelectLis = colorSelectUl.children     /// 这个是颜色框里面的每一个颜色
    let laberColors = document.querySelector('label.colors')      // input 外面的label 
    let colorInput = document.querySelector('input[id="color"]')  // input颜色选择器
    let widthInput = document.querySelector('input[type="range"]')  //笔画粗细

    // 各种画笔的变量名
    let iconBi = document.querySelector('#icon-bi')
    let iconZhiXian = document.querySelector('#icon-zhixian')
    let iconWuBianXing = document.querySelector('#icon-wubianxing')
    let iconYuanXing = document.querySelector('#icon-yuanxing')
    let iconjuXing = document.querySelector('#icon-juXing')


    let buttonSave = document.querySelector('.save')
    let buttonOpen = document.querySelector('.opne')
    let = drawandnosave = false   // 没有修改过画面。为true  // 用来判断是否需要保存


    svgContainer.addEventListener('mousedown', (e) => {

        // 下面是改变input颜色选择器的外面label的颜色也跟着改变
        if (laberColors.contains(e.target)) {    // 这个是修改颜色，把html那个颜色样式也修改
            svgContainer.addEventListener('mouseup' ,(colosE) => {
                laberColors.style.backgroundColor = colorInput.value
            })
            
        }
        
        // 下面是改变滑动条的数字显示
        if (range.contains(e.target)) {     // 修改滑动条的那个文字
            svgContainer.addEventListener('mousemove', function rangeE () {
                rangeText.textContent = range.lastElementChild.value
            })
        }
        
        // 下面是点击右边几个默认颜色，上面的input颜色选择器也跟改，并且svg画图颜色也更改
        if (colorSelectUl.contains(e.target)) {
            if (colorSelectLis[0].contains(e.target)) {
                laberColors.style.backgroundColor =  colorSelectLis[0].style.backgroundColor
                colorInput.value = colorSelectLis[0].style.backgroundColor.colorHex()
            }
            if (colorSelectLis[1].contains(e.target)) {
                laberColors.style.backgroundColor =  colorSelectLis[1].style.backgroundColor
                colorInput.value = colorSelectLis[1].style.backgroundColor.colorHex()
            }
            if (colorSelectLis[2].contains(e.target)) {
                laberColors.style.backgroundColor =  colorSelectLis[2].style.backgroundColor
                colorInput.value = colorSelectLis[2].style.backgroundColor.colorHex()
            }
            if (colorSelectLis[3].contains(e.target)) {
                laberColors.style.backgroundColor =  colorSelectLis[3].style.backgroundColor
                colorInput.value = colorSelectLis[3].style.backgroundColor.colorHex()
            }
            if (colorSelectLis[4].contains(e.target)) {
                laberColors.style.backgroundColor =  colorSelectLis[4].style.backgroundColor
                colorInput.value = colorSelectLis[4].style.backgroundColor.colorHex()
            }
            if (colorSelectLis[5].contains(e.target)) {
                laberColors.style.backgroundColor =  colorSelectLis[5].style.backgroundColor
                colorInput.value = colorSelectLis[5].style.backgroundColor.colorHex()
            }
            if (colorSelectLis[6].contains(e.target)) {
                laberColors.style.backgroundColor =  colorSelectLis[6].style.backgroundColor
                colorInput.value = colorSelectLis[6].style.backgroundColor.colorHex()
            }
            if (colorSelectLis[7].contains(e.target)) {
                laberColors.style.backgroundColor =  colorSelectLis[7].style.backgroundColor
                colorInput.value = colorSelectLis[7].style.backgroundColor.colorHex()
            }

        }
        
        // 下面这个判断的意思是，是中间那块大的toolContainer 但不是两边小的工具容器和颜色容易，就是两边两块工具, 所有工具实现都在这个if里面
        if ( (svg.contains(e.target) || toolContainer.contains(e.target))   && !(colorContainer.contains(e.target) || (toolRangeBox.contains(e.target)))){

            drawandnosave = true   // 改过了画面
                // 这个是画笔工具
            if (iconBi.checked) {  
                console.log(1)
                var pos = mousePos(svg)   // 拿到鼠标开始画的位置
                var polyline = document.createElementNS("http://www.w3.org/2000/svg", 'polyline')
                // 添加一堆Attribute
                polyline.setAttribute('fill', 'none')
                polyline.setAttribute('stroke', colorInput.value)
                polyline.setAttribute('stroke-width', widthInput.value)
                polyline.setAttribute('stroke-linecap', 'round')
                polyline.setAttribute('stroke-linejoin', 'round')

                svg.append(polyline)
                var points = `${pos.x} ${pos.y} `   // 鼠标坐标
                polyline.setAttribute('points', points)   // 位置属性

                function drawDot(e) {   // 鼠标持续移动，持续触发这函数，持续画线
                    var pos = mousePos(svg)
                    var line = document.createElementNS("http://www.w3.org/2000/svg", 'line')
                    points += `${pos.x} ${pos.y} `
                    polyline.setAttribute('points', points)
                }

                svgContainer.addEventListener('mousemove', drawDot)  

                svgContainer.addEventListener('mouseup',  (once) => {
                    svgContainer.removeEventListener('mouseup', once)
                    svgContainer.removeEventListener('mousemove', drawDot)
                })
            }

            // 下面是画圆形
            if (iconYuanXing.checked) {
                var ellipse = document.createElementNS("http://www.w3.org/2000/svg", 'ellipse')   // 创建圆的标签
                svg.append(ellipse)  // 插入svg
                // 然后加一堆属性
                ellipse.setAttribute('stroke', colorInput.value)
                ellipse.setAttribute('stroke-width', widthInput.value)
                ellipse.setAttribute('fill', 'none')

                var startPos = mousePos(svg)   // 获取鼠标相对svg的位置

                function drawEllipse() {
                    var currPos = mousePos(svg)
                    var cx = (startPos.x + currPos.x) / 2
                    var cy = (startPos.y + currPos.y) / 2
                    ellipse.setAttribute('cx', cx)
                    ellipse.setAttribute('cy', cy)
                    var rx = Math.abs(startPos.x - currPos.x) / 2
                    var ry = Math.abs(startPos.y - currPos.y) / 2
                    ellipse.setAttribute('rx', rx)
                    ellipse.setAttribute('ry', ry)
                }

                document.addEventListener('mousemove', drawEllipse)   // 持续运行

                document.addEventListener('mouseup', function once() {  // 解绑
                    document.removeEventListener('mouseup', once)
                    document.removeEventListener('mousemove', drawEllipse)
                })
            }
        }
    })



    // 下面是退出浏览器提示
    // window.addEventListener('beforeunload', e => {
    //   if (drawandnosave) {
    //     return e.returnValue = '还未保存，是否要退出?'
    //   }
    // })
    
    // 将图画保存到桌面
    buttonSave.addEventListener('click' ,function save(){
        drawandnosave = false

        var svgSource = svg.outerHTML
        var blob = new Blob(['<?xml version="1.0" encoding="utf-8"?>', svgSource], { type: "image/xml+svg" })
        var url = URL.createObjectURL(blob)
        var anchor = document.createElement("a")
        anchor.href = url
        anchor.download = "xxxx.svg"
        anchor.click()  // 点击button 也触发a标签点击
    })





    


    //  鼠标相对于元素的位置
    function mousePos(node) {
        var box = node.getBoundingClientRect()

        return {
            x: window.event.clientX - box.x,
            y: window.event.clientY - box.y,
        }
    }

    String.prototype.colorHex = function () {
        // RGB颜色值的正则
        var reg = /^(rgb|RGB)/;
        var color = this;
        if (reg.test(color)) {
            var strHex = "#";
            // 把RGB的3个数值变成数组
            var colorArr = color.replace(/(?:\(|\)|rgb|RGB)*/g, "").split(",");
            // 转成16进制
            for (var i = 0; i < colorArr.length; i++) {
            var hex = Number(colorArr[i]).toString(16);
            if (hex === "0") {
                hex += hex;
            }
            strHex += hex;
            }
            return strHex;
        } else {
            return String(color);
        }
    }
</script>